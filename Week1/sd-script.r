encrypted_text = 
"qptqkkwlckhkmzpnkmupkcvkwzpicacgelmfwhzlzfnmfmcksh
cmfgvnfmrzbtpgybokwilfqbgqujbppqgbrmjiumcgliilzbrg
phqkwzhkbubwvvzlnmpmmbvigbqgvetsmlsuzxhagxkcbgrigj
qewarvyxzbrrpexezjikcbbuigmwbbmqnwoeoipmixrzzdxawh
gxkiuxyahkiykpbqqfascvvvpgcmmueehpsfmlkkpkcigbwkrd
xqlehtvzvzyvqxriigirqbgtxfdbbmfmlkgzhnpleeikqvrpvl
gultwytyuikoxeyqaxhczbaztbvojzizpizlerzkxgaphqslvb
aigbrmnqmfjbufukptpmvwitkqygmquchffxqiawxnvzxganem
tvjxrerxrzymfqqtgmlpqgebuxgudunlqptxofvxtmvlxnvmtt
mfwvugxxpauxerjwbqiohbgelayanwszkmwjqaxezkivfmqmsz
ymvmuznrotimgwalpoemlfmvlehcmmmqamixtmirbuxgudunlq
ptxofvmfmbgpenirrwckibvvmcdryvudtxyzabrmnptriybgkr
vwzwotvkkieiqazehfcmgagavuloayxexzkebbtmphytkmkkmn
lyxvmgazlixofvmfmexwtflxrmpmmuebaczrlruimlnwalizym
kcaahvojsfyvnzisvvmwwhaebvbhydbbhzymmfzrtxlfzwcknw
iynmaydrnwkubaganitxfivfbbvssgcmczfxgaiqmwerwvgnjh
vmftvulvwrprwmlwmkcvgipgpmkqiawpoemlzmgpikebacujxh
kwqgclvyjkimgrigmeibmkqmnoiyuzhnxrkwodxxpabgezfzlr
pvxzkjigbbuxmxtiiyjvemzzmlumhlivimocvgbzktwnlbrkqk
ranpmfemqvmgazlixofvtllnvgkjavmvgksrkwttwvwhownxpm
amxnimtravyaktigydbbhzymmfzrtxynmocebgmlnmvyvgpibv
thqbvfemzvxkgfnvviqlceuxrocmtpvrwxnrbmfmjhvrulhcaa
mauismfqfpeejwfcpvlxuigypwzmlkmqzcvrkiczsbnitxxnvn
bpagpirclhaczxrzvlwcapkmvkqhlwsttucgtjxutfkkqvaqca
ixnildwefyrrbxbjleiuejtrbvlxgrtuczgbexfcgbiawyyvlt
kmgtpizxaczqbwikwluqgvlhvbpcmavmvymkytcaehvblytoxv
zzalwagxquetrqevmgnvltjxutfkkatdbrkwkmmkytjhvjjigb
ajbxiymlumexmtuqvybrwfenzbrqazxnvtxrbrkslkpxawekiy
gwgbqazergptzmgbrzymvgxuxvzvfmjigxvoerhfiagiykzbrp
rfmajqgfqfpsxbxhjqtkevyqtgvixrzvlmfmgtfacikckgteii
qmgknegudxhlmamslkpxtqtxrxvkbnprkxnvbkgbuxqolavgxu
xvnfextmehrrpxkmdvwijrxkmoexwyzdxpqtbhgelipmqbgzrj
ecallxkdnhpajbxiyqgejrmakvvvgxuxvgcxayjrmwcyimgaah
aqewplifmlkmqzcvrkiizxaczjtwuiqzgvnepeumlazvuijsgz
gwitrhrbmgagtfkcttqwvglojjhmsytgowztbmylmmxqhtiaue
zkqlrioxprrahfmonmrkcimvgaizrjnjiexgzrwyrzvmlkdqnq
jhmejumwyzriigkqgekbnrzvzlgoatokpbhqevmgntqifmetpv
yiucbfxzkigecbgxvcymkciftphvzmgiawxxzbacuvnwajmwyn
vqijgimrmegsljcuqbvmyzzwgqjrepgjwlqkuxqkdmtlbgaivr
bmczahjyljlrqgnxofvlawhehhvmtqqyrgnrvzclfbqvcguwar
eiikqgeiaxaqvgdcgfpixvbrnqptprpabloyxauillmzfasxkx
apifxwqewplbbuszyxtpbvxwoeiwtiaviuibkyvffmzkmwmcgh
jhrvwytbgkczbarprfiyjizcjrepgjwlkmgasjkpnqzrjyoimw
qbehrmjmvszvmclfzhltlmlkbmryavmmyimeybvoirpmtqgghw
ktckcifasxksxwxukeyvatwjlttxvdbmcfivomimckbgzkiatr
qbgfkcttqwflcykmfuifvstjqwcznupedwkcarvyxvjeyqfxhk
mqzcvrkivljegauxhnzawcapkmvkqhlwstwodqeyzonxykzhlo
rkeakwdcgpbtnvzucnbkizymvmcemslymgpgvbmuwnkyvpxmtc
imczvgxnvbaamamyxpbacqaoitkqhlwsuircilmapbtnvzpyaz
bwgkbkgjhmijkwogorgixvlttqqdeneqgfqfusubbackbwihim
timelpgdmgrmqmlkdqlybgkmhlbbmvorwgpqgebutxnzammzla
ejzogmzrwxnzabkxbkxgebvmvgkmhlbbmvnghoeamciqgesvlt
pmtkiyjqociawirvuxlbnkcizxaczshvnzuogorgixvbamctal
kyiwlwgamtxbhbwjbxnzbmfmibkkemkckvilkiotgvrwexvxnr
igbstwwkzmvgkkokxnbvhrgctrqbehrmewmclnnxnfztllztxn
vutrqpbettptptrlpakebborwsjxahltrpmytikpwyeggctxbb
uxzoxmgczrvmvymksvokigbiujmvglojxbckrmlkrtifioxxiz
xaczvgeiyqebzrgwsrotxqaxmtjkbcvgbjotifczvvetumlazv
uijkpxtqtxrxvkbnprkeyzuimafbfrvwyrzngwrrbbmvgamyim
isbnmmueetqvbmhkjmktmqvlgitxqjnufgxmbqsahatkwaydru
vubmgydnkmgebhdbuxgogpxpifxexcgtqpbpibvzaclvwrzgcu
jqfalojehpsxtwojsbcvgbvkcgupwxxxnvkbnprketuxnztvll
kubacbrvltzyncqamlkkpvcvgnvevdxljrysxvbagagasaxplm
urlooctxbkertzrvtjgfmwifcebwpveyzwgytyrfxvidrprvmv
ymkgvgaizykxlbhkciigirwtkevyqvqtvwixltxsarweyrktjk
heezzwgyqquczymluqflexdgucbjxitrvwrprommvvxpmpbtnv
zbqavftrvmgmctaxusmtdqrehizxaczvymzzanqmqbrifvcsvp
mmueebrppbtnvzwgaxlxnvkhlnrwixrbxqbnmiyfntkmebggww
kcfnftrvclclnuvgjavgxuxvjzadrwvftrvuxlbgaibzoxlmex
gogpxplhkmtxbacizxvotigaqibpcrzmfmphrlvlxpiprwsval
yorlakimyyzskssjmvpmgtrjkpxsvvhrxvonjieeciiivimqml
kzzfcaftkkjbapwhzlulbmfmjtvzymvmvsxhkiimctrthkiaag
xckmsrzbjgexpovlnnwamlxvmdcgcavgjmlkiavlkjbxpjynjl
twfntrmibzkmmzltrjramfmjtviruxrwnvpujmvmurkiziqusb
vhrmztuczgoixeifrzvxhzfzxnivkxnvjkmsrggogpxpkexezz
vzrproixeiftqtxrkimvgxuxvoejnrvbfezkmkupnmlkuqwrpr
vmvymkuiflxoctostaxvgstxrwpkcvkigytllmymmklizlauis
ameroixvdxlbhtprptxbbbmlkfvxrqzxtguiipwitfrpcgzzrt
ogstxaqcaix"

sqr <- function(x) {
  x * x
}

encryp <- gsub("[\r\n]", "", encrypted_text)
encrypt_split <- strsplit(gsub("[\r\n]", "", encrypted_text), "")[[1]]

for (i in 5:15) {
  total_sd <- 0
  current_position <- 0
  vector_length <- nchar(encryp) / i
  vectors <- c()
  
  # Iterate over all the characters and put them in the right vectors.
  position = 1
  for (character in encrypt_split) {
    wrap_number <- (position %% i) + 1
    if (is.null(vectors[wrap_number]) || is.na(vectors[wrap_number])) {
      vectors[wrap_number] <- character
    } else {
      vectors[wrap_number] <- paste(vectors[wrap_number], character, sep="")
    }
    position <- position + 1
  }
  #frequencies <- as.vector(table(strsplit(substring(encryp, current_position, current_position + vector_length), "")))
  #print(substring(encryp, current_position, current_position + vector_length))
  #current_position <- current_position + vector_length + 1
  #print(table(strsplit(substring(encryp, vector_length * (j - 1), vector_length * j), "")))
  #total_sd <- total_sd + sqrt( sum(frequencies * frequencies) / 26 - sqr( sum(frequencies) / 26 ))
  #total_sd <- total_sd + sd(frequencies)
  
  # Calculate the sd per vector.
  frequencies <- c()
  for (k in 1:i) {
    frequencies[k] <- as.vector(table(strsplit(vectors, "")[k]))
    #print(as.vector(table(strsplit(vectors, "")[k])))
  }
  #total_sd <- sqrt( sum(frequencies * frequencies) / 26 - sqr( sum(frequencies) / 26 ))
  total_sd <- sd(frequencies)
  #for (j in seq(from = i, to = nchar(encryp), by = i)) {
  #  frequencies <- as.vector(table(strsplit(substring(encryp, j - i, j), "")))
  #  total_sd <- total_sd + sd(frequencies)
  #}
  cat("Key", i, "sd:", total_sd, "\n")
}

# Compare frequencies.
vectors <- vector()
position <- 0
for (character in encrypt_split) {
  wrap_number <- (position %% 9) + 1
  #print(wrap_number)
  if (is.null(vectors[wrap_number]) || is.na(vectors[wrap_number])) {
    vectors[wrap_number] <- character
  } else {
    vectors[wrap_number] <- paste(vectors[wrap_number], character, sep="")
  }
  if (position < 9) {
    position <- position + 1
  } else {
    position <- 1
  }
}

# List most likely key characters
alphabet = c('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z')
three <- c('e', 'o', 'g')
distances <- c(match(three[1], alphabet) - 1, match(three[2], alphabet) - 1, match(three[3], alphabet) - 1)
characters <- matrix(nrow = 3, ncol = 9)
for (k in 1:9) {
  #cat(k)
  #print(sort(table(strsplit(vectors[k], "")), decreasing=T))
  x <- vector()
  for (l in 1:3) {
    letter <- rownames(sort(table(strsplit(vectors[k], "")), decreasing=T))[l]
    temp_distance <- match(letter, alphabet) - distances[l]
    if (temp_distance < 1) {
      x[l] <- alphabet[26 + temp_distance]
    } else {
      x[l] <- alphabet[match(letter, alphabet) - distances[l]]
    }
  }
  print(x)
}

