encrypted_text = 
"qptqkkwlckhkmzpnkmupkcvkwzpicacgelmfwhzlzfnmfmcksh
cmfgvnfmrzbtpgybokwilfqbgqujbppqgbrmjiumcgliilzbrg
phqkwzhkbubwvvzlnmpmmbvigbqgvetsmlsuzxhagxkcbgrigj
qewarvyxzbrrpexezjikcbbuigmwbbmqnwoeoipmixrzzdxawh
gxkiuxyahkiykpbqqfascvvvpgcmmueehpsfmlkkpkcigbwkrd
xqlehtvzvzyvqxriigirqbgtxfdbbmfmlkgzhnpleeikqvrpvl
gultwytyuikoxeyqaxhczbaztbvojzizpizlerzkxgaphqslvb
aigbrmnqmfjbufukptpmvwitkqygmquchffxqiawxnvzxganem
tvjxrerxrzymfqqtgmlpqgebuxgudunlqptxofvxtmvlxnvmtt
mfwvugxxpauxerjwbqiohbgelayanwszkmwjqaxezkivfmqmsz
ymvmuznrotimgwalpoemlfmvlehcmmmqamixtmirbuxgudunlq
ptxofvmfmbgpenirrwckibvvmcdryvudtxyzabrmnptriybgkr
vwzwotvkkieiqazehfcmgagavuloayxexzkebbtmphytkmkkmn
lyxvmgazlixofvmfmexwtflxrmpmmuebaczrlruimlnwalizym
kcaahvojsfyvnzisvvmwwhaebvbhydbbhzymmfzrtxlfzwcknw
iynmaydrnwkubaganitxfivfbbvssgcmczfxgaiqmwerwvgnjh
vmftvulvwrprwmlwmkcvgipgpmkqiawpoemlzmgpikebacujxh
kwqgclvyjkimgrigmeibmkqmnoiyuzhnxrkwodxxpabgezfzlr
pvxzkjigbbuxmxtiiyjvemzzmlumhlivimocvgbzktwnlbrkqk
ranpmfemqvmgazlixofvtllnvgkjavmvgksrkwttwvwhownxpm
amxnimtravyaktigydbbhzymmfzrtxynmocebgmlnmvyvgpibv
thqbvfemzvxkgfnvviqlceuxrocmtpvrwxnrbmfmjhvrulhcaa
mauismfqfpeejwfcpvlxuigypwzmlkmqzcvrkiczsbnitxxnvn
bpagpirclhaczxrzvlwcapkmvkqhlwsttucgtjxutfkkqvaqca
ixnildwefyrrbxbjleiuejtrbvlxgrtuczgbexfcgbiawyyvlt
kmgtpizxaczqbwikwluqgvlhvbpcmavmvymkytcaehvblytoxv
zzalwagxquetrqevmgnvltjxutfkkatdbrkwkmmkytjhvjjigb
ajbxiymlumexmtuqvybrwfenzbrqazxnvtxrbrkslkpxawekiy
gwgbqazergptzmgbrzymvgxuxvzvfmjigxvoerhfiagiykzbrp
rfmajqgfqfpsxbxhjqtkevyqtgvixrzvlmfmgtfacikckgteii
qmgknegudxhlmamslkpxtqtxrxvkbnprkxnvbkgbuxqolavgxu
xvnfextmehrrpxkmdvwijrxkmoexwyzdxpqtbhgelipmqbgzrj
ecallxkdnhpajbxiyqgejrmakvvvgxuxvgcxayjrmwcyimgaah
aqewplifmlkmqzcvrkiizxaczjtwuiqzgvnepeumlazvuijsgz
gwitrhrbmgagtfkcttqwvglojjhmsytgowztbmylmmxqhtiaue
zkqlrioxprrahfmonmrkcimvgaizrjnjiexgzrwyrzvmlkdqnq
jhmejumwyzriigkqgekbnrzvzlgoatokpbhqevmgntqifmetpv
yiucbfxzkigecbgxvcymkciftphvzmgiawxxzbacuvnwajmwyn
vqijgimrmegsljcuqbvmyzzwgqjrepgjwlqkuxqkdmtlbgaivr
bmczahjyljlrqgnxofvlawhehhvmtqqyrgnrvzclfbqvcguwar
eiikqgeiaxaqvgdcgfpixvbrnqptprpabloyxauillmzfasxkx
apifxwqewplbbuszyxtpbvxwoeiwtiaviuibkyvffmzkmwmcgh
jhrvwytbgkczbarprfiyjizcjrepgjwlkmgasjkpnqzrjyoimw
qbehrmjmvszvmclfzhltlmlkbmryavmmyimeybvoirpmtqgghw
ktckcifasxksxwxukeyvatwjlttxvdbmcfivomimckbgzkiatr
qbgfkcttqwflcykmfuifvstjqwcznupedwkcarvyxvjeyqfxhk
mqzcvrkivljegauxhnzawcapkmvkqhlwstwodqeyzonxykzhlo
rkeakwdcgpbtnvzucnbkizymvmcemslymgpgvbmuwnkyvpxmtc
imczvgxnvbaamamyxpbacqaoitkqhlwsuircilmapbtnvzpyaz
bwgkbkgjhmijkwogorgixvlttqqdeneqgfqfusubbackbwihim
timelpgdmgrmqmlkdqlybgkmhlbbmvorwgpqgebutxnzammzla
ejzogmzrwxnzabkxbkxgebvmvgkmhlbbmvnghoeamciqgesvlt
pmtkiyjqociawirvuxlbnkcizxaczshvnzuogorgixvbamctal
kyiwlwgamtxbhbwjbxnzbmfmibkkemkckvilkiotgvrwexvxnr
igbstwwkzmvgkkokxnbvhrgctrqbehrmewmclnnxnfztllztxn
vutrqpbettptptrlpakebborwsjxahltrpmytikpwyeggctxbb
uxzoxmgczrvmvymksvokigbiujmvglojxbckrmlkrtifioxxiz
xaczvgeiyqebzrgwsrotxqaxmtjkbcvgbjotifczvvetumlazv
uijkpxtqtxrxvkbnprkeyzuimafbfrvwyrzngwrrbbmvgamyim
isbnmmueetqvbmhkjmktmqvlgitxqjnufgxmbqsahatkwaydru
vubmgydnkmgebhdbuxgogpxpifxexcgtqpbpibvzaclvwrzgcu
jqfalojehpsxtwojsbcvgbvkcgupwxxxnvkbnprketuxnztvll
kubacbrvltzyncqamlkkpvcvgnvevdxljrysxvbagagasaxplm
urlooctxbkertzrvtjgfmwifcebwpveyzwgytyrfxvidrprvmv
ymkgvgaizykxlbhkciigirwtkevyqvqtvwixltxsarweyrktjk
heezzwgyqquczymluqflexdgucbjxitrvwrprommvvxpmpbtnv
zbqavftrvmgmctaxusmtdqrehizxaczvymzzanqmqbrifvcsvp
mmueebrppbtnvzwgaxlxnvkhlnrwixrbxqbnmiyfntkmebggww
kcfnftrvclclnuvgjavgxuxvjzadrwvftrvuxlbgaibzoxlmex
gogpxplhkmtxbacizxvotigaqibpcrzmfmphrlvlxpiprwsval
yorlakimyyzskssjmvpmgtrjkpxsvvhrxvonjieeciiivimqml
kzzfcaftkkjbapwhzlulbmfmjtvzymvmvsxhkiimctrthkiaag
xckmsrzbjgexpovlnnwamlxvmdcgcavgjmlkiavlkjbxpjynjl
twfntrmibzkmmzltrjramfmjtviruxrwnvpujmvmurkiziqusb
vhrmztuczgoixeifrzvxhzfzxnivkxnvjkmsrggogpxpkexezz
vzrproixeiftqtxrkimvgxuxvoejnrvbfezkmkupnmlkuqwrpr
vmvymkuiflxoctostaxvgstxrwpkcvkigytllmymmklizlauis
ameroixvdxlbhtprptxbbbmlkfvxrqzxtguiipwitfrpcgzzrt
ogstxaqcaix"

sqr <- function(x) {
  x * x
}

encryp <- gsub("[\r\n]", "", encrypted_text)
encrypt_split <- strsplit(gsub("[\r\n]", "", encrypted_text), "")[[1]]

# For all possible key sizes, calculate the standard deviation.
for (i in 5:15) {
  total_sd <- 0
  current_position <- 0
  vector_length <- nchar(encryp) / i
  vectors <- c()
  
  # Iterate over all the characters and put them in the right vectors.
  # These vectors are based on the (potential) character in a word.
  # Assuming the key size is correct, you'll get a shifted alphabet in each vector.
  position = 1
  for (character in encrypt_split) {
    if (is.null(vectors[position]) || is.na(vectors[position])) {
      vectors[position] <- character
    } else {
      vectors[position] <- paste(vectors[position], character, sep="")
    }
    if (position < i) {
      position <- position + 1
    } else {
      position <- 1
    }
  }
  
  # Calculate the sd per vector and sum them for all vectors.
  for (k in 1:i) {
    frequencies <- as.vector(table(strsplit(vectors, "")[k]))
    total_sd <- total_sd + sqrt( sum(frequencies * frequencies) / 26 - sqr( sum(frequencies) / 26 ))
  }
  # Print the standard deviation for the key.
  cat("Key", i, "sd:", total_sd, "\n")
}

# List most likely key characters
alphabet = c('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z')
three <- c('e', 'o', 'g') # most frequent characters according to the assignment
distances <- c(match(three[1], alphabet) - 1, match(three[2], alphabet) - 1, match(three[3], alphabet) - 1)
for (k in 1:9) {
  x <- vector()
  # For all three possible letters, get the likely key character by shifting.
  for (l in 1:3) {
    letter <- rownames(sort(table(strsplit(vectors[k], "")), decreasing=T))[l]
    temp_distance <- match(letter, alphabet) - distances[l]
    if (temp_distance < 1) {
      x[l] <- alphabet[26 + temp_distance]
    } else {
      x[l] <- alphabet[match(letter, alphabet) - distances[l]]
    }
  }
  print(x)
}

# Decryption:
decrypted_string <- ""
alphabet = c('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z')
keystring <- c('i', 'n', 't', 'e', 'g', 'r', 'i', 't', 'y')
position <- 1

# For every character we shift the character in the alphabet according to the respective distance.
# This distance determines on the position in the keyword. This results in a decrypted text.
for (character in encrypt_split) {
  distance <- match(character, alphabet) - match(keystring[position], alphabet)
  if (distance < 0) {
    distance <- distance + 26
  }
  decrypted_string <- paste(decrypted_string, alphabet[distance + 1], sep="")
  if (position < 9) {
    position <- position + 1
  } else {
    position <- 1
  }
}

print(decrypted_string)

